<?phprequire_once '../modelo/conexiondb.php';require_once '../modelo/Bitacora_modelo.php';  $usuario = trim($_POST["usuario"]);  $clave = trim($_POST["pass"]);    $conn = conexion::getInstance();    $stmt = $conn->prepare("SELECT * FROM usuario WHERE usuario = ?");  $stmt->bind_param('s', $usuario);  $stmt->execute();  $result = $stmt->get_result();  if(mysqli_num_rows($result) > 0){    $row = $result->fetch_assoc();    $stmt->close();    if(strcmp($row['clave'], $clave) == 0){      session_start();      $_SESSION["usuario"] = $row["usuario"];       $_SESSION["nombre"] = $row["nombre"];      $_SESSION["apellido"] = $row["apellido"];      $_SESSION["idtipousuario"] = $row['idtipousuario'];      $_SESSION["iddepartamento"] = $row['iddepartamento'];      $_SESSION["idusuario"] = $row['idusuario'];      $res = $conn->query("SELECT nombredepartamento FROM departamento WHERE iddepartamento = '".$row['iddepartamento']."'");      $row = $res->fetch_assoc();      $_SESSION["nombredepartamento"] = $row["nombredepartamento"];            // MANEJO DEL INGRESO AL SISTEMA EN LA BITACORA      $array = [      "idusuario" => $_SESSION["idusuario"],      "detalle" => "Ingreso al sistema del usuario: " .$_SESSION["usuario"]. "",      ];      $log = new Bitacora();      $log1 = $log->agregarLog( $array );            switch ($_SESSION["idtipousuario"]) {	case 1: 	  header('Location: ../vista/indexAdmin.php');	  break;	case 2:	  header('Location: ../vista/indexCoordinador.php');	  break;	case 3:	  header('Location: ../vista/indexTutor.php');	  break;	case 5:	  header('Location: ../vista/indexAuxiliar.php');	  break;      }          }else {      header("Location: ../vista/index.php?error=1");      exit();    }  }else {    $stmt = $conn->prepare("SELECT * FROM estudiante WHERE carnet = ?");    $stmt->bind_param('s', $usuario);    $stmt->execute();    $result = $stmt->get_result();    if(mysqli_num_rows($result) > 0) {      $row = $result->fetch_assoc();      $stmt->close();      if(strcmp($row['clave'], $clave) == 0) {	session_start(); 	$_SESSION["carnet"] = $row["carnet"]; 	$_SESSION["nombreestudiante"] = $row["nombreestudiante"];	$_SESSION["apellido"] = $row["apellidoestudiante"];	$_SESSION["carrera"] = $row["carrera"];	$_SESSION["idtipousuario"] = $row['tipousuario'];	$_SESSION["iddepartamento"] = $row['departamento'];	$res = $conn->query("SELECT nombrecarrera FROM carrera WHERE idcarrera = '".$row['carrera']."'");	$row = $res->fetch_assoc();	$_SESSION["nombrecarrera"]=$row['nombrecarrera'];	header('Location: ../vista/indexEstudiante.php');	exit();      }else {	header("Location: ../vista/index.php?error=1");	exit();      }    }else {      /* NO EXISTE USUARIO MANDAR ERROR  */      header("Location: ../vista/index.php?error=3");      exit();    }      }